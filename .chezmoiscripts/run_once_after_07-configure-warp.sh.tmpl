#!/bin/bash

{{ if eq .chezmoi.os "darwin" -}}
echo "Configuring Warp terminal..."

# Wait for Warp to be installed
if ! [ -d "/Applications/Warp.app" ]; then
    echo "Waiting for Warp to be installed..."
    sleep 2
fi

# Create Warp config directory
WARP_CONFIG_DIR="$HOME/.warp"
mkdir -p "$WARP_CONFIG_DIR"

# Apply theme if custom theme file exists
if [ -f "$HOME/.config/warp/theme.yaml" ]; then
    # Copy theme to Warp's theme directory
    WARP_THEMES_DIR="$HOME/.warp/themes"
    mkdir -p "$WARP_THEMES_DIR"
    cp "$HOME/.config/warp/theme.yaml" "$WARP_THEMES_DIR/monokai-soda.yaml"
    echo "✓ Monokai Soda theme installed"
fi

# Create launch agent for global hotkey support (optional)
# This helps Warp respond to global shortcuts more reliably
LAUNCH_AGENTS_DIR="$HOME/Library/LaunchAgents"
mkdir -p "$LAUNCH_AGENTS_DIR"

echo "✓ Warp configuration complete!"
echo ""
echo "Warp settings to configure manually:"
echo "1. Open Warp → Settings (Cmd+,)"
echo "2. Appearance → Theme → Choose 'Monokai Soda' (if available)"
echo "3. Appearance → Font → Set to 'FiraCode Nerd Font'"
echo "4. Features → Set fish as default shell (should auto-detect)"
echo ""
echo "Keyboard shortcut configured:"
echo "  Option + Space → Show/Hide Warp"
echo ""
echo "Note: Warp has many built-in features:"
echo "  - Cmd+P for command palette"
echo "  - AI assistance with Cmd+G"
echo "  - Block selection and editing"
echo "  - Automatic command history"

{{ else -}}
echo "Warp configuration is only supported on macOS"
{{ end -}}